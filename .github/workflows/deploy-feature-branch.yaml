name: "deploy-feature-branch"

on:
  push:
    branches:
      - "np**"
  pull_request:
    branches:
      - "np**"

jobs:
  build-lambda-1:
    name: "Build Lambda 1"
    uses: ./.github/workflows/python-workflow.yaml
    with:
      python-version: "3.12"
      lambda: "lambda-1"

  deploy-infra:
    name: "Deploy Infra to AWS"
    permissions:
      issues: write
    uses: ./.github/workflows/apply-infra-workflow.yaml
    needs: [build-lambda-1]
    with:
      terraform_version: "1.8.3"
      environment: "dev"
      branch: ${{ github.head_ref || github.ref_name }}
      aws-region: "sa-east-1"
      aws-assume-role-arn: "aws-assume-role-arn"
      aws-state-file-s3-bucket: "aws-state-file-s3-bucket"
      aws-state-lock-dynamodb-table: "aws-state-lock-dynamodb-table"
